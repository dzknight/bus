{% extends "base.html" %}

{% block title %}Team2 - 노선별 교통량 분석{% endblock %}

{% block extra_css %}
<style>
    .sidebar {
        min-width: 200px;
        max-width: 220px;
        height: 100vh;
        position: fixed;
        top: 0;
        left: 0;
        background-color: #f8f9fa;
        padding: 2rem 1rem;
        border-right: 1px solid #ccc;
        z-index: 1000;
    }

    .main-content {
        margin-left: 220px;
        padding: 2rem;
    }

    .route-link {
        display: block;
        margin-bottom: 10px;
        color: #0d6efd;
        text-decoration: none;
        padding: 8px 12px;
        border-radius: 4px;
        transition: background-color 0.2s ease;
    }

    .route-link:hover {
        background-color: #e9ecef;
        text-decoration: none;
    }

    .route-link.active {
        background-color: #0d6efd;
        color: white;
    }

    .chart-container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        margin-bottom: 20px;
    }

    .table-container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .table-responsive {
        max-height: 600px;
        overflow-y: auto;
    }

    .team2-table {
        font-size: 14px;
    }

    .team2-table th {
        background-color: #f8f9fa;
        position: sticky;
        top: 0;
        z-index: 10;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- 사이드바 -->
        <div class="col-md-3 col-lg-2">
            <div class="sidebar">
                <h5 class="mb-3">노선 선택</h5>
                {% for route in routes %}
                    <a href="{{ url_for('teams.get_team2') }}?route={{ route }}"
                       class="route-link {% if route == selected_route %}active{% endif %}">
                        {{ route }}
                    </a>
                {% endfor %}
            </div>
        </div>

        <!-- 메인 콘텐츠 -->
        <div class="col-md-9 col-lg-10">
            <div class="main-content">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>{{ selected_route }} 노선 - 상위 20개 데이터</h2>
                    <div class="text-muted">
                        총 {{ routes|length }}개 노선 중 선택됨
                    </div>
                </div>

                <!-- 차트 영역 -->
                <div class="chart-container">
                    <h5 class="mb-3">시간대별 평균 이용객수</h5>
                    <canvas id="lineChart" height="100"></canvas>
                </div>

                <!-- 테이블 영역 -->
                <div class="table-container">
                    <h5 class="mb-3">상세 데이터</h5>
                    <div class="table-responsive">
                        {{ table | safe }}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Jinja2 변수를 JavaScript 변수로 미리 선언
    var chartLabels = {{ chart_labels | default('[]') | tojson }};
    var chartValues = {{ chart_values | default('[]') | tojson }};
    
    document.addEventListener('DOMContentLoaded', function() {
        // Chart.js 설정
        const ctx = document.getElementById('lineChart').getContext('2d');
        const lineChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: chartLabels,
                datasets: [{
                    label: '평균 이용객수',
                    data: chartValues,
                    borderColor: 'rgba(75, 192, 192, 1)',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    fill: true,
                    tension: 0.3,
                    pointRadius: 4,
                    pointHoverRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    }
                },
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: '시작 시각 (시)'
                        },
                        grid: {
                            display: true,
                            color: 'rgba(0,0,0,0.1)'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: '평균 이용객수'
                        },
                        beginAtZero: true,
                        grid: {
                            display: true,
                            color: 'rgba(0,0,0,0.1)'
                        }
                    }
                },
                interaction: {
                    mode: 'nearest',
                    axis: 'x',
                    intersect: false
                }
            }
        });

        // 반응형 처리
        window.addEventListener('resize', function() {
            lineChart.resize();
        });
    });
</script>
{% endblock %}
